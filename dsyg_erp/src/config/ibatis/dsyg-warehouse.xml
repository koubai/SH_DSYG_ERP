<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap
        PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
        "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="com.cn.tbps">

	<resultMap id="WarehouseDto" class="com.cn.dsyg.dto.WarehouseDto">
		<result property="id" column="id" />
		<result property="parentid" column="parentid" />
		<result property="warehousetype" column="warehousetype" />
		<result property="warehouseno" column="warehouseno" />
		<result property="belongto" column="belongto" />
		<result property="theme1" column="theme1" />
		<result property="theme2" column="theme2" />
		<result property="productid" column="productid" />
		<result property="quantity" column="quantity" />
		<result property="actualquantity" column="actualquantity" />
		<result property="unitprice" column="unitprice" />
		<result property="amount" column="amount" />
		<result property="taxamount" column="taxamount" />
		<result property="warehousedate" column="warehousedate" />
		<result property="handler" column="handler" />
		<result property="supplierid" column="supplierid" />
		<result property="approverid" column="approverid" />
		<result property="note" column="note" />
		<result property="rank" column="rank" />
		<result property="status" column="status" />
		<result property="res01" column="res01" />
		<result property="res02" column="res02" />
		<result property="res03" column="res03" />
		<result property="res04" column="res04" />
		<result property="res05" column="res05" />
		<result property="res06" column="res06" />
		<result property="res07" column="res07" />
		<result property="res08" column="res08" />
		<result property="res09" column="res09" />
		<result property="res10" column="res10" />
		<result property="createuid" column="createuid" />
		<result property="createdate" column="createdate" />
		<result property="updateuid" column="updateuid" />
		<result property="updatedate" column="updatedate" />
	</resultMap>
	
	<resultMap id="WarehouseOkDto" class="com.cn.dsyg.dto.WarehouseOkDto">
		<result property="quantity" column="quantity" />
		<result property="supplierid" column="supplierid" />
		<result property="suppliername" column="suppliername" />
		<result property="productid" column="productid" />
		<result property="theme1" column="theme1" />
		<result property="tradename" column="tradename" />
		<result property="typeno" column="typeno" />
		<result property="color" column="color" />
		<result property="packaging" column="packaging" />
		<result property="unit" column="unit" />
	</resultMap>
	
	<!-- WarehouseOk begin -->
	<select id="queryWarehouseOkByPage" parameterClass="java.util.Map" resultMap="WarehouseOkDto">
		select sum(A.quantity) as quantity,A.suppliername,A.tradename,A.typeno,A.color,A.packaging,A.unit,A.supplierid,A.theme1,A.productid from (
			select T.*,
				(select S.suppliername from etb_supplier S where S.id = T.supplierid) as suppliername,
				(select P.tradename from etb_product P where P.id = T.productid) as tradename,
				(select P.typeno from etb_product P where P.id = T.productid) as typeno,
				(select P.color from etb_product P where P.id = T.productid) as color,
				(select P.packaging from etb_product P where P.id = T.productid) as packaging,
				(select P.unit from etb_product P where P.id = T.productid) as unit
			from etb_warehouse T where 1 = 1 and T.status = #status#
		) A group by A.tradename,A.typeno,A.color,A.packaging,A.unit,A.supplierid,A.theme1,A.productid
		order by A.tradename asc
		LIMIT #start#, #end#
	</select>

	<select id="queryWarehouseOkCountByPage" resultClass="int" parameterClass="java.util.Map">
		select count(*) from (
			select sum(A.quantity) as quantity,A.suppliername,A.tradename,A.typeno,A.color,A.packaging,A.unit,A.supplierid,A.theme1,A.productid from (
				select T.*,
					(select S.suppliername from etb_supplier S where S.id = T.supplierid) as suppliername,
					(select P.tradename from etb_product P where P.id = T.productid) as tradename,
					(select P.typeno from etb_product P where P.id = T.productid) as typeno,
					(select P.color from etb_product P where P.id = T.productid) as color,
					(select P.packaging from etb_product P where P.id = T.productid) as packaging,
					(select P.unit from etb_product P where P.id = T.productid) as unit
				from etb_warehouse T where 1 = 1 and T.status = #status#
			) A group by A.tradename,A.typeno,A.color,A.packaging,A.unit,A.supplierid,A.theme1,A.productid
		) B
	</select>
	
	<select id="queryWarehouseBySupplieridProductid" parameterClass="java.util.Map" resultMap="WarehouseDto">
		select T.* from etb_warehouse T where 1 = 1 and T.status = #status# and T.productid = #productid# and T.supplierid = #supplierid#
	</select>
	<!-- WarehouseOk end -->
	
	
	
	<select id="queryWarehouseByPage" parameterClass="java.util.Map" resultMap="WarehouseDto">
		select T.* from etb_warehouse T where 1 = 1
		<isNotEmpty prepend="and" property="parentid">
			T.parentid = #parentid#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="warehousetype">
			T.warehousetype = #warehousetype#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="warehouseno">
			T.warehouseno = #warehouseno#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="theme1">
			T.theme1 = #theme1#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="supplierid">
			T.supplierid = #supplierid#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="productid">
			T.productid = #productid#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			T.status = #status#
		</isNotEmpty>
		order by T.warehousedate desc
		LIMIT #start#, #end#
	</select>
	
	<select id="queryWarehouseCountByPage" resultClass="int" parameterClass="java.util.Map">
		select count(*) from etb_warehouse T where 1 = 1
		<isNotEmpty prepend="and" property="parentid">
			T.parentid = #parentid#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="warehousetype">
			T.warehousetype = #warehousetype#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="warehouseno">
			T.warehouseno = #warehouseno#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="theme1">
			T.theme1 = #theme1#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="supplierid">
			T.supplierid = #supplierid#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="productid">
			T.productid = #productid#
		</isNotEmpty>
		<isNotEmpty prepend="and" property="status">
			T.status = #status#
		</isNotEmpty>
	</select>
	
	<select id="queryWarehouseByID" parameterClass="java.util.Map" resultMap="WarehouseDto">
		select * from etb_warehouse where id = #id#
	</select>
	
	<select id="queryWarehouseByParentidAndProductid" parameterClass="java.util.Map" resultMap="WarehouseDto">
		select * from etb_warehouse where parentid = #parentid# and productid = #productid#
	</select>
	
	<select id="queryWarehouseByWarehouseno" parameterClass="java.util.Map" resultMap="WarehouseDto">
		select * from etb_warehouse where warehouseno = #warehouseno#
	</select>
	
	<insert id="insertWarehouse" parameterClass="com.cn.dsyg.dto.WarehouseDto">
		insert into etb_warehouse(parentid,warehousetype,warehouseno,belongto,theme1,theme2,productid,quantity,
			actualquantity,unitprice,amount,taxamount,warehousedate,handler,supplierid,approverid,note,rank,status,
			res01,res02,res03,res04,res05,res06,res07,res08,res09,res10,createuid,createdate,updateuid,updatedate)
		values(#parentid#,#warehousetype#,#warehouseno#,#belongto#,#theme1#,#theme2#,#productid#,#quantity#,
			#actualquantity#,#unitprice#,#amount#,#taxamount#,#warehousedate#,#handler#,#supplierid#,#approverid#,#note#,#rank#,#status#,
			#res01#,#res02#,#res03#,#res04#,#res05#,#res06#,#res07#,#res08#,#res09#,#res10#,#createuid#,NOW(),#updateuid#,NOW())
	</insert>
	
	<update id="updateWarehouse" parameterClass="com.cn.dsyg.dto.WarehouseDto">
		update etb_warehouse
		set warehouseno = #warehouseno#,
			quantity = #quantity#,
			actualquantity = #actualquantity#,
			unitprice = #unitprice#,
			amount = #amount#,
			taxamount = #taxamount#,
			note = #note#,
			rank = #rank#,
			status = #status#,
			res01 = #res01#,
			res02 = #res02#,
			res03 = #res03#,
			res04 = #res04#,
			res05 = #res05#,
			res06 = #res06#,
			res07 = #res07#,
			res08 = #res08#,
			res09 = #res09#,
			res10 = #res10#,
			updateuid = #updateuid#,
			updatedate = NOW()
		where id = #id#
	</update>
	
</sqlMap>